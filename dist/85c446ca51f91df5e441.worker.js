!function(t){var e={};function s(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(i,o,function(e){return t[e]}.bind(null,o));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=9)}([function(t,e,s){"use strict";s.d(e,"a",(function(){return DateUtils}));class DateUtils{static getDaysBetween(t,e){t=new Date(t),e=new Date(e),t=this.normalizeDateUp(t),e=this.normalizeDateUp(e);const s=Math.abs(+t-+e);return Math.round(s/864e5)}static normalizeDateUp(t){return(t=new Date(+t)).setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}static normalizeDateDown(t){return(t=new Date(+t)).setHours(23),t.setMinutes(59),t.setSeconds(59),t.setMilliseconds(499),t}static getGlobalDay(t){return this.getDaysBetween(new Date(0),+t)}static getDateFromGlobalDay(t){return this.normalizeDateUp(new Date(864e5*t))}static combineDate(t,e){const s=new Date(+t);return s.setHours(e.getHours()),s.setMinutes(e.getMinutes()),s.setSeconds(e.getSeconds()),s.setMilliseconds(e.getMilliseconds()),s}static getReadableDuration(t){const e=Math.floor(t/60/60),s=Math.floor((t-3600*e)/60);return(e>0?e+" h, ":"")+(s>0?s+" min, ":"")+Math.floor(t-3600*e-60*s)+" sec"}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return Filter}));class Filter{constructor(t){this.enabled=!0,this.id=t}toggle(t){this.enabled=null==t?!this.enabled:t}toObject(){return Object.assign({},this)}}},function(t,e,s){"use strict";s.d(e,"b",(function(){return Session})),s.d(e,"a",(function(){return i}));var i,o=s(0);class Session{constructor(t,e=t,s=i.unknown){t instanceof Date&&(t=Math.round(+t/1e3)),e instanceof Date&&(e=Math.round(+e/1e3)),t>=e&&(t=e-15),this.from=new Date(1e3*t),this.to=new Date(1e3*Math.max(t,e)),this.platform=s,this.inSleep=!1}get length(){return Math.round((+this.to-+this.from)/1e3)}isCovered(t,e=!0){const s=e?+o.a.normalizeDateUp(this.from):+this.from,i=e?+o.a.normalizeDateDown(this.to):+this.to;return+t>=s&&+t<=i}isOverNight(){return this.from.getDate()!==this.to.getDate()||this.from.getMonth()!==this.to.getMonth()||this.from.getFullYear()!==this.to.getFullYear()}splitOverNights(){const t=[];if(!this.isOverNight())return[this];let e=new Date(+this.from),s=new Date(+this.from);s=o.a.normalizeDateDown(s),t.push(new Session(e,s,this.platform));const i=o.a.getDaysBetween(this.from,this.to)-1;for(let n=0;n<i;n++)e.setDate(e.getDate()+1),s.setDate(s.getDate()+1),e=o.a.normalizeDateUp(e),s=o.a.normalizeDateDown(s),t.push(new Session(e,s,this.platform));return e=new Date(+this.to),s=new Date(+this.to),+(e=o.a.normalizeDateUp(e))!=+s&&t.push(new Session(e,s,this.platform)),t}toObject(){return Object.assign({},this)}}!function(t){t[t.unknown=0]="unknown",t[t.mobile=1]="mobile",t[t.iphone=2]="iphone",t[t.ipad=3]="ipad",t[t.android=4]="android",t[t.wphone=5]="wphone",t[t.windows=6]="windows",t[t.web=7]="web"}(i||(i={}))},function(t,e,s){"use strict";s.d(e,"a",(function(){return Day}));var i=s(0);class Day{constructor(t,e=[]){this.date=i.a.normalizeDateUp(t),this.sessions=e}addSession(t){if(t instanceof Array)for(const e of t)this.addSession(e);else this.sessions.push(t)}getSession(t,e=!1){let s=null,i=1/0;for(const o of this.sessions){if(o.isCovered(t,!1))return o;if(e){const e=Math.min(Math.abs(+o.from-+t),Math.abs(+o.to-+t));e<i&&(i=e,s=o)}}return s}applySessionsFilter(t){if(!t.enabled)return new Day(new Date(+this.date),this.sessions.slice(0));const e=new Day(this.date),s=this.sessions.filter(e=>t.passSession(e));return e.addSession(s),e}applyFilter(t){const e=new Day(new Date(+this.date),this.sessions.slice(0));return t.enabled?t.passDay(e)?e:null:e}toObject(){const t=Object.assign({},this);t.sessions=[];for(const e in this.sessions)t.sessions.push(this.sessions[e].toObject());return t}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return EmptyFilter}));var i=s(1);class EmptyFilter extends i.a{constructor(){super(...arguments),this.type="empty"}passDay(t){return 0!=t.sessions.length}passSession(t){return!0}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return DeviceFilter}));var i=s(1),o=s(2);class DeviceFilter extends i.a{constructor(t,e=null){super(t),this.type="device",this.platform=e}passDay(t){return!0}passSession(t,e=null){return null==(e=e||this.platform)||-1==e||(Array.isArray(e)?e.some(e=>this.passSession(t,e)):"string"==typeof e?o.a[t.platform]==e.toLowerCase():!!Number.isFinite(e)&&t.platform==e)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return PeriodFilter}));var i=s(1),o=s(0);class PeriodFilter extends i.a{constructor(t,e=-1/0,s=1/0){super(t),this.type="period",this.from=e,this.to=Math.max(s,e)}passDay(t){const e=o.a.getGlobalDay(t.date);return e>=this.from&&e<=this.to}passSession(t){return!0}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return Drawer}));class Drawer{constructor(t,e=null){const s=t.getContext("2d");if(!s)throw new Error("Unable to get canvas context!");this.canvas=t,this.context=s,this.user=e,this.stylesCache={},this.styles={zoom:1},this.updateStyles()}render(){if(null==this.user)return;this.context.clearRect(0,0,this.viewport.width,this.viewport.height),this.drawTime(this.context);const t=this.user.getDays();Object.keys(t).length>0&&this.drawData(this.context,t)}updateStyles(t=null){t?this.stylesCache=t:t=this.stylesCache,this.styles.column={margin:4},this.styles.date={height:48,font:t.fontFamily||"Arial",color:t.color||"black"},this.styles.time={margin:this.viewport.height/this.styles.zoom/96,left:8,fontSize:(this.viewport.height/this.styles.zoom-48)/24,size:(this.viewport.height-this.styles.date.height)/24,font:t.fontFamily||"Arial",color:t.color||"black"}}set zoom(t){this.styles.zoom=t,this.updateStyles()}set colors(t){this.styles.colors=t}get viewport(){return{width:this.canvas.width,height:this.canvas.height}}drawData(t,e){const s=3*this.styles.time.fontSize,i=this.styles.column.margin,o=(this.viewport.width-s)/e.length,n=this.styles.date.height,r=this.styles.date.color,a=this.styles.date.font,l=Math.min(n/2.3,(this.viewport.width-s)/(3*e.length)),h=(this.viewport.height-n)/24;t.font=l+"px "+a,t.textAlign="center";let c=null;for(let a=0;a<e.length;a++){const u=e[a],f=u.date.toString().split(" "),d=f[0],p=f[1]+" "+f[2];t.fillStyle=r,t.fillText(d,s+o*a+o/2,this.viewport.height-l),t.fillText(p,s+o*a+o/2,this.viewport.height);const y=o*a+s+i/2;for(const e of u.sessions){const s=h*e.from.getHours()+h/60*e.from.getMinutes()+h/60/60*e.from.getSeconds();let n=h*((+e.to-+e.from)/1e3/60/60);n<1&&(n=1),t.fillStyle=this.styles.colors[e.platform],t.fillRect(y,s,o-i,n),null!=c&&(t.globalAlpha=.3,this.shadeRect(t,y,c,o-i,s-c,.15),t.globalAlpha=1,c=null),e.inSleep&&(c=s+n,1==e.inSleep?t.strokeStyle="black":2==e.inSleep?t.strokeStyle="green":3==e.inSleep&&(t.strokeStyle="red"))}null!=c&&(t.globalAlpha=.3,this.shadeRect(t,y,c,o-i,this.viewport.height-n-c,.15),t.globalAlpha=1,c=0)}}drawTime(t){const e=this.styles.time.margin,s=this.styles.time.fontSize,i=this.styles.time.size,o=this.styles.time.color,n=this.styles.time.font;t.font=s+"px "+n,t.fillStyle=o,t.textAlign="left";for(let o=0;o<24;o++){const n=(1==o.toString().length?"0":"")+o+":00";t.fillText(n,e,i*o+s/2.5+i/2),t.globalAlpha=.15,t.fillRect(0,i*o+i,this.viewport.width,1),t.globalAlpha=1}}shadeRect(t,e=0,s=0,i=0,o=0,n=.1){const r=Math.max(i,o),a=1/n,l=2*Math.ceil(r/a);let[h,c]=[0,0],[u,f]=[0,0];for(let n=0;n<l;n++)t.beginPath(),t.moveTo(e+u,s+c),t.lineTo(e+h,s+f),t.stroke(),(h+=a)>i&&((f+=h-i)>o&&(f=o),h=i),(c+=a)>o&&((u+=c-o)>i&&(u=i),c=o)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return User}));var i=s(0),o=s(3),n=s(2),r=s(4),a=s(5),l=s(6);class User{constructor(t,e){this.days={},this.filters=[],this.id=e,this.name=t}getDays(t=!0){const e=[],s=this.getDaysEnumenator(t);let i=null;for(;null!=(i=s());)e.push(i);return e}getDaysEnumenator(t=!0){const e=Object.keys(this.days),s=+e[e.length-1];let i=+e[0];return()=>{if(i>s)return null;{let e=null;for(;null==e;){if(void 0===(e=this.days[i]))return e;if(i++,t){for(const t of this.filters)e=e.applySessionsFilter(t);for(const t of this.filters){if(null===e)break;e=e.applyFilter(t)}}}return e}}}addSession(t){if(t.isOverNight()){for(const e of t.splitOverNights())this.addSession(e);return}const e=i.a.getGlobalDay(t.from);if(void 0===this.days[e]){const s=Object.keys(this.days);if(s.length>0){const t=+s[0],n=+s[s.length-1];for(let s=e+1;s<t;s++)this.days[s]=new o.a(i.a.getDateFromGlobalDay(s));for(let t=e-1;t>n;t--)this.days[t]=new o.a(i.a.getDateFromGlobalDay(t))}this.days[e]=new o.a(t.from)}this.days[e].addSession(t)}addFilter(t){this.filters.push(t)}getFilter(t){return this.filters.find(e=>e.id==t)}clearFilters(){this.filters=[]}toObject(){const t=Object.assign({},this);t.days={};for(const e in this.days)t.days[e]=this.days[e].toObject();t.filters=[];for(const e in this.filters)t.filters.push(this.filters[e].toObject());return t}static fromObject(t){const e=new User(t.name,+t.id);if(t.sessions)for(const s of t.sessions)void 0!==s.from&&e.addSession(new n.b(s.from,s.to,s.platform));else if(t.days)for(const s of Object.values(t.days))if(s.sessions)for(const t of s.sessions)void 0!==t.from&&e.addSession(new n.b(t.from,t.to,t.platform));if(t.filters){t.filters.forEach(t=>{switch((t=Object.assign({},t)).type){case"empty":t.__proto__=r.a.prototype;break;case"device":t.__proto__=a.a.prototype;break;case"period":t.__proto__=l.a.prototype}e.addFilter(t)})}else{const t=new r.a("empty"),s=new a.a("device"),i=new l.a("period"),o=Object.keys(e.days);t.toggle(!1),i.from=+o[0],i.to=+o[o.length-1],e.addFilter(t),e.addFilter(s),e.addFilter(i)}return e}}},function(t,e,s){"use strict";s.r(e);var i=s(7),o=s(8);const n=self;let r,a,l=!1;const h=()=>{r.render(),l=!1};function c(){r&&!l&&(requestAnimationFrame(h),l=!0)}n.addEventListener("message",t=>{switch(t.data.message){case"initialize":!function(t){a=t,r=new i.a(t)}(t.data.canvas);break;case"updateUser":!function(t){t=o.a.fromObject(t),r.user=t,c()}(t.data.user);break;case"updateZoom":!function(t){r.zoom=t}(t.data.factor);break;case"updateColors":!function(t){r.colors=t,c()}(t.data.colors);break;case"updateViewport":!function(t,e){a.width=t,a.height=e,r.updateStyles(),c()}(t.data.width,t.data.height);break;case"updateStyles":!function(t){r.updateStyles(t),c()}(t.data.styles);break}})}]);